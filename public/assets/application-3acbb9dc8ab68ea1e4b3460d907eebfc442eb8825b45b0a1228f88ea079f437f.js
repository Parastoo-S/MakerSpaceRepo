function voting(){$("a.upvote, a.downvote").on("ajax:success",function(e,t){var n=$(this)[0];console.log("anything"),$(n).siblings().css("color","#999"),$(n).siblings().each(function(){"div"!==$(this)[0].localName&&(this.href=this.origin+this.pathname+this.search.substring(0,11)+"&voted="+t.voted)}),n.href=n.origin+n.pathname+n.search.substring(0,11)+"&voted="+t.voted,$("div.upvote-"+t.comment_id).text(t.upvote_count),$(this).css("color",t.color)})}function resetFormElement(e){var t=$(e);t.wrap("<form>").closest("form").get(0).reset(),t.unwrap()}function addFiles(e,t,n){var i=t[n];e.push(i),$.get("/template/file",{file:i.name},function(i){$("div#file-container").append(i);var a=$("div#file-container")[0].children.length-1,o=$("div#file-container")[0].children[a];$(o.children[1]).click(function(){var t=$(o).index();e.splice(t,1),$(o).remove()}),t.length!==++n&&addFiles(e,t,n)},"html")}function addPhotos(e,t,n){var i=t[n];if(i.type.match(/image.*/)){e.push(i);var a=new FileReader;a.readAsDataURL(i),a.onload=function(i){loadImage(i.target.result,e),t.length!==++n&&addPhotos(e,t,n)}}}function loadImage(e,t){var n=$("<div>").addClass("image-item"),i=$("<span>").addClass("image-remove"),a=$("<img>").attr("src",e);n.append(a),n.append(i),$("div#image-container").append(n),i.click(function(){var e=n.index();t.splice(e,1),n.remove()})}function readURL(e){if(e.files&&e.files[0].type.match(/image.*/)){var t=new FileReader;t.readAsDataURL(e.files[0]),t.onload=function(e){$("img.edit-avatar").attr("src",e.target.result)}}}function dragndrop(){$(this).on("dragenter",function(e){e.stopPropagation(),e.preventDefault(),$("div.repo-image").css("border","2px solid #0B85A1")}),$(this).on("dragover",function(e){e.stopPropagation(),e.preventDefault()}),$(this).on("drop",function(e){$("div.repo-image").css("border","1px dashed #aaa"),e.preventDefault();var t=e.originalEvent.dataTransfer;if(t.files&&t.files[0]){var n=$.extend(!0,[],t.files);addPhotos(photoFiles,n,0)}})}function photoSwipe(){var e=document.querySelectorAll(".pswp")[0],t=photoArray,n={index:0},i=new PhotoSwipe(e,PhotoSwipeUI_Default,t,n);return i}var instructableFiles=[],photoFiles=[],tagArray=[],photoArray=[];$(document).on("page:change",function(){voting(),$("a.repository_report").click(function(){$("div.spinner").css("display","inline-block")}),$("div#repository_report").fadeIn(500).delay(5e3).fadeOut(300),$("form#comment").on("ajax:success",function(e,t){params={username:t.username,user_id:t.user_id,user_url:t.user_url,content:t.comment,comment_id:t.comment_id,created_at:t.created_at},$.get("/template/comment",params,function(e){var t=$("span.comment-count").text();$("span.comment-count").text(parseInt(t)+1),$("div#comment-container").prepend(e),$("textarea#content").val(""),voting()},"html")}),$("a.like").on("ajax:success",function(e,t){return t.failed?!1:void $("span.like-count").text(t.like)}),photoArray=[];var e=photoSwipe();$("div#photo-slide").children().each(function(){var t=$(this);photoArray.push({src:t.attr("src"),w:t.data().width,h:t.data().height}),t.click(function(){e.options.index=t.index(),e.init()})}),$("div#show-photo").click(function(){e.init()}),$("input#tag").keypress(function(e){var t=$(this),n=t.val();if(13==e.keyCode){if(t.val(""),6===$("div#tag-container").children().length)return!1;e.preventDefault(),$(this).css("margin-bottom","10px"),tagArray.push(n),$.get("/template/tag",{tag:n},function(e){$("div#tag-container").append(e);var t=$("div#tag-container")[0].children.length-1,n=$("div#tag-container")[0].children[t];$(n).click(function(){var e=$(n).index();tagArray.splice(e,1),$(n).remove()})},"html")}}),$("span.menu-button").hover(function(){$("ul.menu").fadeIn(100)},function(){$("ul.menu").fadeOut(100)}),$("div#filter-header").click(function(){$("ul.filter").slideDown(100,function(){$(document).click(function(){$("ul.filter").slideUp(100),$(this).off("click")})})}),dragndrop.call($("div#dragndrop")),$("select").selectmenu({width:422,position:{my:"left top+5",at:"left bottom"}}),$("input#user_avatar").change(function(){readURL(this)}),$("input#images_").change(function(){var e=$(this)[0];if(e.files&&e.files[0]){var t=$.extend(!0,[],e.files);addPhotos(photoFiles,t,0)}resetFormElement(e)}),$("input#files_").change(function(){var e=$(this)[0];if(e.files&&e.files[0]){var t=$.extend(!0,[],e.files);addFiles(instructableFiles,t,0)}resetFormElement(e)}),$("form#new_repository").submit(function(e){e.preventDefault();for(var t=$(this),n=t[0].action,i=new FormData(t[0]),a=0;a<instructableFiles.length;a++)i.append("files[]",instructableFiles[a]);for(var a=0;a<photoFiles.length;a++)i.append("images[]",photoFiles[a]);for(var a=0;a<tagArray.length;a++)i.append("tags[]",tagArray[a]);$.ajax({url:n,type:"POST",data:i,dataType:"json",processData:!1,contentType:!1}).done(function(e){window.location.pathname=e.redirect_uri}).fail(function(){console.log("error")})})});