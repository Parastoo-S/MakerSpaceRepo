
<% if flash[:notice] %>
  <div id="repository_report"><%= flash[:notice] %></div>
<% end %>

<section id="show-repository">
  <section id="repository-photos">

    <div id="show-photo">
      <%= image_tag @photos.first.image.url, data: { width: @photos.first.width, height: @photos.first.height} %>
    </div>
    <div id="photo-slide">
      <% @photos.each do |p| %> 
        <%= image_tag p.image.url, data: { width: p.width, height: p.height} %>
      <% end %>
    </div>
  </section>

  <section id="info">
    <div id="repo-title">
      <%= @repository.title %>
    </div>
    <div id="misc">
      <span class="misc-item"><%= fa_icon "heart" %><span class="like-count"><%= @repository.like %></span></span>
      <span class="misc-item"><%= fa_icon "code-fork", text: @repository.makes.count %></span>
      <span class="misc-item"><%= fa_icon "comments"%><span class="comment-count"><%= @repository.comments.count %></span></span>
    </div>
    <div id="repo-info">
      <div class="repo-info-item">
        <div class="title">PROJECT BY</div>
        <div class="name"><%= link_to @repository.user_username, user_path(@repository.user_username) %></div>
        <div class="reputation">1530</div>
      </div>
      <div class="repo-info-item">
        <div class="title">PUBLISHED</div>
        <div class="date"><%= @repository.created_at.strftime("%b %e %Y") %></div>
      </div>
      <% if @repository.github.present? %>
      <div class="repo-info-item">
        <div class="title">GITHUB</div>
        <div class="name"><%= link_to(fa_icon('github-alt', text: @repository.github), @repository.github_url )%></div>
      </div>
      <% end %>
      <% if @repository.description.present? %>
      <div class="repo-info-item">
        <div class="title">DESCRIPTION</div>
        <div class="description"><%= @repository.description %></div>
      </div>
      <% end %>
      <% if @repository.category.present? %>
      <div class="repo-info-item">
        <div class="title">PLATFORM</div>
        <span class="platform"><%= link_to @repository.category, platform_path(platform: @repository.category) %></span>
      </div>
      <% end %>
      <% if @tags.present? %>
      <div class="repo-info-item">
        <div class="title">TAGS</div>
        <% @tags.each do |t| %>
          <span class="tags"><%= link_to t.name, search_path(q: t.name) %></span>
        <% end %>
      </div>
      <% end %>

      <div class="repo-info-item">
        <span class="like">
          <%= link_to(fa_icon('heart', text: 'Like'), 
            add_like_repository_path, class: 'like', remote: true, method: :post) %>
        </span>
        <span class="make">
          <%= link_to(fa_icon('code-fork', text: 'Make'),
            makes_new_path(@repository.user_username, @repository.title)) %>
        </span>
      </div>
      <div class="repo-info-item">
        <div class="report">
          <%= link_to fa_icon('flag', text: 'Report inapropriate'), report_repository_path(@repository.id), class: 'repository_report' %>
          <div class="spinner">
            <div class="rect1"></div>
            <div class="rect2"></div>
            <div class="rect3"></div>
            <div class="rect4"></div>
            <div class="rect5"></div>
          </div>
        </div>
      </div>
      <% if @repository.license.present? %>
      <div class="repo-info-item">
        <div class="title">LICENSE</div>
        <span class="license"><%= link_to @repository.license, license_url[@repository.license] %></span>
      </div>
      <% end %>
    </div>

  </section>

  <section id="repo-comments">
    <div class="title">Comments</div>
    <%= form_tag comments_create_path, id: 'comment', remote: true do %>
      <%= text_area_tag 'content', nil, rows: 5, placeholder: 'Add a new comment' %>
      <%= submit_tag 'Post comment' %>
    <% end %>

    <div id="comment-filters">
      <% if params['comment_filter'].eql?('newest')
        then bold = %w(font-weight:700 font-weight:400) 
        else bold = %w(font-weight:400 font-weight:700) 
        end %>
      <%= link_to "Top votes", repository_path(comment_filter: :top) + "#repo-comments", style: bold.last %>
      <%= link_to "Newest", repository_path(comment_filter: :newest) + "#repo-comments", style: bold.first %>
    </div>
    <div id="comment-container">
      <% @comments.each do |comment|%>
      <div class="comment">
        <div class="comment-upvote">
          <%=
            vote = @vote.flatten.include?(comment.id)
            color = @vote.include?([comment.id, false]) ? '#19c1a5' : '#999'
            link_to fa_icon('angle-up'), vote_path(comment_id: comment.id, 
            voted: vote, downvote: 'f'), class: 'vote upvote', remote: true, method: :post, style: "color: #{color}" 
          %>
          <div class="upvote upvote-<%= comment.id %>"><%= comment.upvote %></div>
          <%=
            color = @vote.include?([comment.id, true]) ? '#19c1a5' : '#999'
            link_to fa_icon('angle-down'), vote_path(comment_id: comment.id, 
            voted: vote, downvote: 't'), class: 'vote downvote', remote: true, method: :post, style: "color: #{color}" 
          %>
        </div>
        <div class="comment-header">
          <%= link_to user_path(comment.username) do %>
            <div><%= comment.username %><div class="rep">1530</div> </div>
           <% end %>
          <%= content_tag :div, time_ago_in_words(comment.created_at) << " ago", class: 'time' %>
        </div>
        <div class="comment-content">
          <%= comment.content %>
        </div>
      </div> 
      <% end %>
      <%= paginate @comments %>
    </div>
  </section>
</section>

<%= render 'layouts/photoswipe' %>